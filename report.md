# Part 1. Настройка gitlab-runner

== Задание ==

- Подними виртуальную машину Ubuntu Server 22.04 LTS.

![Alt text](screen/1.png)


- Скачай и установи на виртуальную машину gitlab-runner.

![Alt text](screen/2.png)

    - Скачала и установила gitlab-runner через [бинарный файл с официального сайта](https://docs.gitlab.com/runner/install/linux-manually.html)
    - Запустила, дала файлу разрешение на исполнение
    - Создала пользователя и установила, как службу
    - Запустила службу 
    
- Запусти gitlab-runner и зарегистрируй его для использования в текущем проекте (DO6_CICD).

Для регистрации понадобятся URL и токен, которые можно получить на страничке задания на платформе.

![Alt text](screen/3.png)

![Alt text](screen/4.png)

# Part 2. Сборка

== Задание ==

- Напиши этап для CI по сборке приложений из проекта C2_SimpleBashUtils.

    - Создала файл в корне репозитория .gitlab-ci.yml

- В файле gitlab-ci.yml добавь этап запуска сборки через мейк файл из проекта C2.

![Alt text](screen/5.png)

Столкнулась с ошибкой при команде: "git push origin develop"

![Alt text](screen/6.png) 

Закомментировала строки в /home/gitlab-runner/.bash_logout. Запустила и проверила на ошибки

![Alt text](screen/7.png) 
     
![Alt text](screen/8.png) 

- Файлы, полученные после сборки (артефакты), сохрани в произвольную директорию со сроком хранения 30 дней.

Сборка прошла успешно, файлы сохранила в произвольную директорию со сроком хранения 30 дней
     
![Alt text](screen/9.png) 

# Part 3. Тест кодстайла

== Задание ==

- Напиши этап для CI, который запускает скрипт кодстайла (clang-format). В пайплайне отобрази вывод утилиты clang-format.

![Alt text](screen/10.png) 

Проверила локально сначала вывод команды 

![Alt text](screen/11.png) 

- Если кодстайл не прошел, то «зафейли» пайплайн.

Пайплан был "зафейлин"

![Alt text](screen/12.png) 

![Alt text](screen/13.png) 

- В пайплайне отобрази вывод утилиты clang-format.

Исправила ошибку,  проект успешно прошел  

![Alt text](screen/14.png) 

![Alt text](screen/15.png) 

# Part 4. Интеграционные тесты

== Задание ==

- Напиши этап для CI, который запускает твои интеграционные тесты из того же проекта.

![Alt text](screen/16.png) 

- Запусти этот этап автоматически только при условии, если сборка и тест кодстайла прошли успешно. Если тесты не прошли, то «зафейли» пайплайн.

![Alt text](screen/17.png) 

Проверила сначала вывод интеграционных тестов локально

![Alt text](screen/18.png) 

![Alt text](screen/19.png) 

Проверила, что пайплайн "зафейлился"

- В пайплайне отобрази вывод, что интеграционные тесты успешно прошли / провалились.

![Alt text](screen/20.png) 

![Alt text](screen/21.png) 

# Part 5. Этап деплоя

== Задание ==

- Подними вторую виртуальную машину Ubuntu Server 22.04 LTS.

![Alt text](screen/22.png) 

- Напиши этап для CD, который «разворачивает» проект на другой виртуальной машине. Запусти этот этап вручную при условии, что все предыдущие этапы прошли успешно.

![Alt text](screen/23.png) 

Настроила адаптеры двух машин на внутреннюю сеть. Sudo vim /etc/netplan/00-network-manager-all.yaml. 

![Alt text](screen/24.png) 

Проверила соединение между машинами

![Alt text](screen/25.png) 

Сгенерировала пару ключей для каждой машины 

![Alt text](screen/26.png) 

Дописала .gitlab-ci.yml

![Alt text](screen/28.png) 

Скопировала содержимое ткрытого ssh-ключа на удаленный сервер

![Alt text](screen/29.png)

Выдала права для чтения и работы с этим файлом

![Alt text](screen/41.png)

- Напиши bash-скрипт, который при помощи ssh и scp копирует файлы, полученные после сборки (артефакты), в директорию /usr/local/bin второй виртуальной машины.

![Alt text](screen/31.png)

 - В пайплайне отобрази вывод, что тест в виде deploy прошли / провалились.
 
 ![Alt text](screen/32.png)

 - Переходим в пайплайн и видим,что deploy прошел / провалился.

 ![Alt text](screen/33.png)

 - Переходим в машину ws2 для проверки копирования. Заходим в дирикторию /usr/local/bin/s21*. Есть оба файла s21_cat & s21 grep? То копировние прошло успешно!  

 ![Alt text](screen/34.png)

 Ну и на всяйки случай проверим работу deploy, если все условия не будут выполнены!
 

 # Part 6. Дополнительно. Уведомления 
 - Найдем в телеграме через поиск `BotFather`

 ![Alt text](screen/35.png)

 > В диалоге необходимо будет написать: <br>
> - имя бота `blackfyd DO6_CICD» в Telegram` <br>
> - юзернейм для бота (имя должно быть уникальным и заканчиваться на `bot`)

 ![Alt text](screen/36.png)

 - В результате мы получили `API` бота. Теперь найдем бота `getmyid_bot` и напишем ему `/start` для получения нашего `ID`

  ![Alt text](screen/37.png)

  Настрой уведомления о успешном/неуспешном выполнении пайплайна через бота с именем `blackfyd DO6_CICD` в Telegram .

    ![Alt text](screen/38.png)


 - Создаем src/notify.sh для отправок сообщений в бота с именем `blackfyd DO6_CICD` в Telegram 
      ![Alt text](screen/40.png)

 - Изменим немного `gitlab-ci.yml` дополнив строку с запуском src/notify.sh 

    ![Alt text](screen/38.png)

    - И наблюдаем за оповещениям в бота с именем `blackfyd DO6_CICD` в Telegram 

    ![Alt text](screen/39.png)